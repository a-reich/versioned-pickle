
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>versioned_pickle API reference &#8212; versioned-pickle  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-versioned_pickle">
<span id="versioned-pickle-api-reference"></span><h1>versioned_pickle API reference<a class="headerlink" href="#module-versioned_pickle" title="Permalink to this heading">¶</a></h1>
<p>Main module of versioned-pickle.</p>
<p>The main API consists of these functions:</p>
<p><a class="reference internal" href="#versioned_pickle.dump" title="versioned_pickle.dump"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dump()</span></code></a></p>
<p><a class="reference internal" href="#versioned_pickle.load" title="versioned_pickle.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load()</span></code></a></p>
<p>These can be used as a nearly drop-in replacement for the corresponding functions from the stdlib <code class="docutils literal notranslate"><span class="pre">pickle</span></code> module.
Only these are needed for normal use. Additional public objects
(including EnvironmentMetadata and PackageMismatchWarning) are exposed only for introspecting
or potentially customizing the treatment of environment metadata and handling of mismatches.</p>
<dl class="py class">
<dt class="sig sig-object py" id="versioned_pickle.EnvironmentMetadata">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">versioned_pickle.</span></span><span class="sig-name descname"><span class="pre">EnvironmentMetadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">packages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">py_ver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">package_scope</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'object'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'loaded'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'installed'</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#versioned_pickle.EnvironmentMetadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Class for managing metadata about the environment used when creating or loading a versioned pickle.</p>
<p>Typically not needed when using the main dump/load API. If one does need to construct instances,
from_scope can calculate the needed data from high-level intent.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="versioned_pickle.EnvironmentMetadata.packages">
<span class="sig-name descname"><span class="pre">packages</span></span><a class="headerlink" href="#versioned_pickle.EnvironmentMetadata.packages" title="Permalink to this definition">¶</a></dt>
<dd><p>dict of distribution names to version strings</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="versioned_pickle.EnvironmentMetadata.py_ver">
<span class="sig-name descname"><span class="pre">py_ver</span></span><a class="headerlink" href="#versioned_pickle.EnvironmentMetadata.py_ver" title="Permalink to this definition">¶</a></dt>
<dd><p>the python interpreter version</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[int, int, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="versioned_pickle.EnvironmentMetadata.package_scope">
<span class="sig-name descname"><span class="pre">package_scope</span></span><a class="headerlink" href="#versioned_pickle.EnvironmentMetadata.package_scope" title="Permalink to this definition">¶</a></dt>
<dd><p>the type of scope that was used for which packages to include.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>{“object”, “loaded”, “installed”}</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="versioned_pickle.EnvironmentMetadata.from_header_dict">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_header_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#versioned_pickle.EnvironmentMetadata" title="versioned_pickle.EnvironmentMetadata"><span class="pre">EnvironmentMetadata</span></a></span></span><a class="headerlink" href="#versioned_pickle.EnvironmentMetadata.from_header_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Inverse of to_header_dict - create an instance from a native dict in the pickle-header format.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="versioned_pickle.EnvironmentMetadata.from_scope">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_scope</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">package_scope</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'object'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'loaded'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'installed'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'object'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_modules</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#versioned_pickle.EnvironmentMetadata" title="versioned_pickle.EnvironmentMetadata"><span class="pre">EnvironmentMetadata</span></a></span></span><a class="headerlink" href="#versioned_pickle.EnvironmentMetadata.from_scope" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct an EnvironmentMetadata based on the type of scope for which packages to include.</p>
<p>This is the typical way to construct instances, not calling the class name directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>package_scope</strong> (<em>{&quot;object&quot;</em><em>, </em><em>&quot;loaded&quot;</em><em>, </em><em>&quot;installed&quot;}</em>) – can be “object” meaning the specific modules needed for an object, in which case module names
must be specified in object_modules, or “loaded”, or “installed”.</p></li>
<li><p><strong>object_modules</strong> (<em>optional Iterable</em><em>[</em><em>str</em><em>]</em><em>,</em>) – module names needed to pickle an object and for which to record pkg versions.
Only used if package_scope is ‘object’. Needed modules can be determined automatically using
_IntrospectionPickler.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="versioned_pickle.EnvironmentMetadata.to_header_dict">
<span class="sig-name descname"><span class="pre">to_header_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#versioned_pickle.EnvironmentMetadata.to_header_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a representation of the metadata as a Python-native dict.</p>
<p>Used when one doesn’t want to have import versioned_pickle itself, such as in the header created
for pickle files.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="versioned_pickle.EnvironmentMetadata.validate_against">
<span class="sig-name descname"><span class="pre">validate_against</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">loaded_env</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#versioned_pickle.EnvironmentMetadata" title="versioned_pickle.EnvironmentMetadata"><span class="pre">EnvironmentMetadata</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#versioned_pickle.PackageMismatchWarning" title="versioned_pickle.PackageMismatchWarning"><span class="pre">PackageMismatchWarning</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#versioned_pickle.EnvironmentMetadata.validate_against" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate the environment metadata instance against the one for the loading environment.</p>
<p>Typically this would not be called by users, but should be handled by the dump/load API.
The validation logic compares only the packages dict, and ignores extra packages in
the loading env.</p>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="versioned_pickle.PackageMismatchWarning">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">versioned_pickle.</span></span><span class="sig-name descname"><span class="pre">PackageMismatchWarning</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mismatches</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#versioned_pickle.PackageMismatchWarning" title="Permalink to this definition">¶</a></dt>
<dd><p>Warning class used when loading pickled data whose metadata doesn’t validate against the loading env.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="versioned_pickle.dump">
<span class="sig-prename descclassname"><span class="pre">versioned_pickle.</span></span><span class="sig-name descname"><span class="pre">dump</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">IO</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">package_scope</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'object'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'loaded'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'installed'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'object'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#versioned_pickle.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Pickle an object’s data to a file with environment metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obj</strong> (<em>any object to pickle</em>) – </p></li>
<li><p><strong>file</strong> (<em>file-like obj</em><em> (</em><em>writable</em><em>, </em><em>binary mode</em><em>)</em>) – </p></li>
<li><p><strong>package_scope</strong> (<em>optional str {'object'</em><em>, </em><em>'loaded'</em><em>, </em><em>'installed'}</em><em>,</em>) – How to determine which packages to include in metadata.
“object”: the specific modules needed to pickle the object,
or “loaded”: any module that has currently been imported (regardless of where),
or “installed”: all installed distributions.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="versioned_pickle.dumps">
<span class="sig-prename descclassname"><span class="pre">versioned_pickle.</span></span><span class="sig-name descname"><span class="pre">dumps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">package_scope</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'object'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'loaded'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'installed'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'object'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bytes</span></span></span><a class="headerlink" href="#versioned_pickle.dumps" title="Permalink to this definition">¶</a></dt>
<dd><p>Like dump, but returns an in-memory bytes object instead of using a file.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="versioned_pickle.load">
<span class="sig-prename descclassname"><span class="pre">versioned_pickle.</span></span><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">IO</span><span class="p"><span class="pre">[</span></span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_meta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#versioned_pickle.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load an object from a pickle file saved by ‘dump’, and validate the environment metadata.</p>
<p>The saved EnvironmentMetadata from the environment that dumped the file is checked against the
current EnvironmentMetadata. Extra packages in the load env are ignored as is python version.
If they do not match, a PackageMismatchWarning is warned with details of the mismatches.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file</strong> (<em>file-like obj</em><em> (</em><em>readable</em><em>, </em><em>binary mode</em><em>)</em>) – </p></li>
<li><p><strong>return_meta</strong> (<em>optional bool</em>) – if True return a tuple of the object and its metadata</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="versioned_pickle.loads">
<span class="sig-prename descclassname"><span class="pre">versioned_pickle.</span></span><span class="sig-name descname"><span class="pre">loads</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_meta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">object</span></span></span><a class="headerlink" href="#versioned_pickle.loads" title="Permalink to this definition">¶</a></dt>
<dd><p>Like load, but takes a bytes-like object.</p>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">versioned-pickle</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, a-reich.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/API_reference.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>